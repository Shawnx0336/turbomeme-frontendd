<!DOCTYPE html>
<html lang="en" x-data="crashApp" x-init="init()">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#121212">
  <title>SOL Crash | 1000x Multipliers</title>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.0/dist/cdn.min.js" defer></script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" defer></script>
  <style>
    :root {
      --primary: #7B61FF;
      --secondary: #FF6BEC;
      --bg: #121212;
      --card-bg: #1E1E1E;
    }
    * {
      -webkit-tap-highlight-color: transparent;
      -webkit-overflow-scrolling: touch;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: white;
      margin: 0;
      padding: 0;
      overscroll-behavior: none;
      touch-action: manipulation;
    }
    #app {
      display: flex;
      flex-direction: column;
      height: 100vh;
      height: -webkit-fill-available;
      overflow: hidden;
    }
    /* Mobile-optimized game area */
    #game {
      flex: 1;
      padding: 15px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    #multiplier {
      font-size: 3.5rem;
      font-weight: 800;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
      margin: 10px 0;
      line-height: 1;
    }
    #graph-container {
      flex: 1;
      min-height: 200px;
      background: var(--card-bg);
      border-radius: 12px;
      position: relative;
      margin: 0 0 15px;
      overflow: hidden;
    }
    #rocket-line {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 3px;
      background: linear-gradient(to top, var(--primary), var(--secondary));
      height: 0;
    }
    #rocket {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 24px;
      transition: bottom 0.05s linear;
      image-rendering: crisp-edges;
    }
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 15px;
    }
    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      user-select: none;
    }
    button:active:not(:disabled) {
      transform: scale(0.98);
    }
    button:disabled {
      opacity: 0.6;
    }
    input {
      padding: 12px;
      border-radius: 8px;
      border: none;
      background: var(--card-bg);
      color: white;
      font-size: 1rem;
      width: 100%;
      -webkit-appearance: none;
    }
    /* Mobile tabs */
    .mobile-tabs {
      display: flex;
      border-top: 1px solid #333;
      background: var(--card-bg);
    }
    .tab-button {
      flex: 1;
      padding: 12px;
      text-align: center;
      font-size: 0.8rem;
    }
    .tab-button.active {
      border-bottom: 2px solid var(--primary);
    }
    /* Tab content */
    .tab-content {
      display: none;
      padding: 15px;
      overflow-y: auto;
      max-height: 40vh;
    }
    .tab-content.active {
      display: block;
    }
    /* Mobile modals */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.9);
      z-index: 100;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }
    .modal-content {
      background: var(--card-bg);
      border-radius: 12px;
      width: 100%;
      max-width: 400px;
      max-height: 80vh;
      overflow-y: auto;
      padding: 20px;
      -webkit-overflow-scrolling: touch;
    }
    /* Performance optimizations */
    .will-change {
      will-change: transform, opacity;
    }
    /* iPhone notch/padding */
    @supports (padding-bottom: env(safe-area-inset-bottom)) {
      body {
        padding-bottom: env(safe-area-inset-bottom);
      }
      .mobile-tabs {
        padding-bottom: env(safe-area-inset-bottom);
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Main Game Area -->
    <div id="game">
      <h1 style="text-align: center; font-size: 1.5rem; margin: 0;">üöÄ SOL CRASH</h1>
      <div id="multiplier" x-text="`${multiplier.toFixed(2)}x`" class="will-change"></div>
      
      <div id="graph-container">
        <div id="rocket-line" class="will-change"></div>
        <img id="rocket" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik0xMy4xMyAyMi4xOUwxMS4zIDIwLjM3Yy0uNjguNjgtMS42LjY4LTIuMjggMC0uNjgtLjY4LS42OC0xLjYgMC0yLjI4TDEzLjEzIDE0bDEuNzYtMS43NmMuNjgtLjY4IDEuNi0uNjggMi4yOCAwIC42OC42OC42OCAxLjYgMCAyLjI4TDE1LjQxIDE0bDMuNTQgMy41NGMuNjguNjguNjggMS42IDAgMi4yOC0uNjguNjgtMS42LjY4LTIuMjggMGwtMS43Ni0xLjc2em0tMS40MS02LjgybC0xLjc2LTEuNzZjLS42OC0uNjgtLjY4LTEuNiAwLTIuMjguNjgtLjY4IDEuNi0uNjggMi4yOCAwbDEuNzYgMS43NiAxLjc2LTEuNzZjLjY4LS42OCAxLjYtLjY4IDIuMjggMCAuNjguNjguNjggMS42IDAgMi4yOGwtMS43NiAxLjc2IDEuNzYgMS43NmMuNjguNjguNjggMS42IDAgMi4yOC0uNjguNjgtMS42LjY4LTIuMjggMGwtMS43Ni0xLjc2LTEuNzYgMS43NmMtLjY4LjY4LTEuNi42OC0yLjI4IDAtLjY4LS42OC0uNjgtMS42IDAtMi4yOGwxLjc2LTEuNzZ6Ii8+PC9zdmc+" alt="Rocket" class="will-change">
      </div>

      <div class="controls">
        <input type="number" x-model="betAmount" min="0.01" step="0.01" placeholder="0.01 SOL" inputmode="decimal">
        <button id="start-btn" @click="startGame()" :disabled="gameRunning">BET</button>
        <button id="auto-btn" @click="toggleAuto()" :style="autoPlay ? 'background: var(--secondary)' : ''">AUTO</button>
        <button id="cashout-btn" @click="cashOut()" :disabled="!gameRunning || !canCashout">CASH OUT</button>
      </div>
    </div>

    <!-- Mobile Tabs -->
    <div class="mobile-tabs">
      <div class="tab-button active" @click="activeTab = 'chat'">üí¨ Chat</div>
      <div class="tab-button" @click="activeTab = 'wallet'">üí∞ Wallet</div>
      <div class="tab-button" @click="activeTab = 'stats'">üìä Stats</div>
    </div>

    <!-- Tab Contents -->
    <div class="tab-content" :class="{ 'active': activeTab === 'chat' }">
      <div x-html="chatMessages" style="padding: 5px;"></div>
    </div>
    
    <div class="tab-content" :class="{ 'active': activeTab === 'wallet' }">
      <div style="padding: 10px;">
        <div style="font-size: 1.5rem; margin: 10px 0;" x-text="`${balance.toFixed(2)} SOL`"></div>
        <button @click="connectWallet()" x-show="!userLoggedIn" style="width: 100%; margin: 5px 0;">CONNECT WALLET</button>
        <button @click="openModal('deposit')" x-show="userLoggedIn" style="width: 100%; margin: 5px 0;">DEPOSIT</button>
        <button @click="openModal('withdraw')" x-show="userLoggedIn" style="width: 100%; margin: 5px 0; background: #F87171;">WITHDRAW</button>
      </div>
    </div>
    
    <div class="tab-content" :class="{ 'active': activeTab === 'stats' }">
      <div style="padding: 10px;">
        <h3>TOP WINS</h3>
        <div style="margin-top: 10px;">
          <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #333;">
            <span>SOL_Whale</span>
            <span>12.34x (8.42 SOL)</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #333;">
            <span>CryptoDegen</span>
            <span>9.87x (5.21 SOL)</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #333;">
            <span>You</span>
            <span x-text="`${biggestWin.toFixed(2)}x (${(biggestWin * betAmount).toFixed(2)} SOL)`">0.00x (0.00 SOL)</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Modals -->
    <div x-show="modalOpen" class="modal-overlay" @click.self="closeModal()">
      <div class="modal-content">
        <template x-if="modalType === 'deposit'">
          <div>
            <h2>DEPOSIT SOL</h2>
            <p>Send SOL to this address:</p>
            <p style="word-break: break-all; background: #333; padding: 10px; border-radius: 4px; font-family: monospace;">7eSH...fT9q</p>
            <p>Minimum deposit: 0.1 SOL</p>
            <button @click="closeModal()" style="width: 100%; margin-top: 15px;">CLOSE</button>
          </div>
        </template>
        
        <template x-if="modalType === 'withdraw'">
          <div>
            <h2>WITHDRAW SOL</h2>
            <p>Available: <span x-text="balance.toFixed(2)"></span> SOL</p>
            <p style="color: var(--secondary);">‚ö†Ô∏è First withdrawals take 24 hours</p>
            <input type="number" x-model="withdrawAmount" placeholder="0.1 SOL" style="width: 100%; margin: 10px 0;">
            <button @click="requestWithdraw()" style="width: 100%;">REQUEST</button>
            <button @click="offerDouble()" style="width: 100%; margin-top: 10px; background: gold; color: black;">DOUBLE OR NOTHING</button>
          </div>
        </template>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.data('crashApp', () => ({
        // Game State
        gameRunning: false,
        multiplier: 1.00,
        crashAt: 2.0,
        betAmount: 0.01,
        balance: 0.05,
        autoPlay: false,
        canCashout: false,
        biggestWin: 0,
        
        // UI State
        modalOpen: false,
        modalType: '',
        activeTab: 'chat',
        userLoggedIn: false,
        withdrawAmount: 0.1,
        
        // Fake Chat
        chatMessages: `
          <div style="padding: 8px 0; border-bottom: 1px solid #333;">
            <span style="color: var(--secondary); font-weight: bold;">SOL_Whale:</span> Just won 5 SOL! üöÄ
          </div>
          <div style="padding: 8px 0; border-bottom: 1px solid #333;">
            <span style="color: var(--secondary); font-weight: bold;">System:</span> Welcome to SOL Crash!
          </div>
        `,
        
        init() {
          // Lock orientation on mobile
          screen.orientation?.lock('portrait').catch(() => {});
          
          // Prevent zooming
          document.addEventListener('gesturestart', (e) => e.preventDefault());
          
          // Fake chat updates
          setInterval(() => {
            const users = ['SOL_Whale', 'CryptoDegen', 'Anonymous'];
            const messages = [
              `Cashed out at ${(Math.random() * 10 + 1).toFixed(2)}x!`,
              'Deposited 5 SOL ü§ë',
              'Why did I cash out early??',
              'BRO THIS GAME IS LIT üî•'
            ];
            const user = users[Math.floor(Math.random() * users.length)];
            const msg = messages[Math.floor(Math.random() * messages.length)];
            
            this.chatMessages = `
              <div style="padding: 8px 0; border-bottom: 1px solid #333;">
                <span style="color: var(--secondary); font-weight: bold;">${user}:</span> ${msg}
              </div>
              ${this.chatMessages}
            `;
          }, 8000);
        },
        
        // Game Logic (optimized for mobile)
        startGame() {
          if (this.gameRunning) return;
          if (this.balance < this.betAmount) {
            this.openModal('deposit');
            return;
          }
          
          this.gameRunning = true;
          this.multiplier = 1.00;
          this.canCashout = true;
          this.balance -= this.betAmount;
          
          // Mobile-optimized RNG
          const salt = Date.now() % 1000;
          const fakeHash = String(salt * 12345).split('').reverse().join('');
          const random = parseInt(fakeHash.substr(0,5)) / 99999;
          this.crashAt = 1 + Math.floor(random * 100) / 10;
          
          // Dynamic difficulty
          if (this.balance > 0.5) this.crashAt = Math.min(this.crashAt, 2.5);
          if (this.balance < 0.02) this.crashAt = Math.max(this.crashAt, 3.0);
          
          this.animateGame();
        },
        
        animateGame() {
          if (!this.gameRunning) return;
          
          this.multiplier += 0.01;
          
          // Mobile-optimized animation
          const lineHeight = (this.multiplier - 1) * 30;
          document.getElementById('rocket-line').style.height = `${lineHeight}px`;
          document.getElementById('rocket').style.bottom = `${lineHeight}px`;
          
          // Crash check
          if (this.multiplier >= this.crashAt) {
            this.gameRunning = false;
            setTimeout(() => {
              alert(`CRASHED AT ${this.crashAt.toFixed(2)}x!`);
              if (this.autoPlay) setTimeout(() => this.startGame(), 500);
            }, 50); // Faster mobile response
          } else {
            requestAnimationFrame(() => this.animateGame());
          }
        },
        
        cashOut() {
          if (!this.gameRunning || !this.canCashout) return;
          
          const winnings = this.betAmount * this.multiplier;
          this.balance += winnings;
          if (this.multiplier > this.biggestWin) this.biggestWin = this.multiplier;
          
          this.gameRunning = false;
          this.addMessage('You', `Cashed out at ${this.multiplier.toFixed(2)}x! Won ${winnings.toFixed(2)} SOL`);
          
          if (this.autoPlay) setTimeout(() => this.startGame(), 500);
        },
        
        // Mobile UX
        openModal(type) {
          this.modalType = type;
          this.modalOpen = true;
          document.body.style.overflow = 'hidden';
        },
        
        closeModal() {
          this.modalOpen = false;
          document.body.style.overflow = '';
        },
        
        connectWallet() {
          this.userLoggedIn = true;
          this.addMessage('System', 'Wallet connected!');
          setTimeout(() => this.openModal('deposit'), 300);
        },
        
        requestWithdraw() {
          alert('Withdrawal requested! Processing will take 24 hours.');
          this.closeModal();
        },
        
        offerDouble() {
          if (confirm('DOUBLE OR NOTHING: Bet your withdrawal for 2x?')) {
            if (Math.random() > 0.4) { // 60% chance to lose
              alert('You won! Withdrawal doubled!');
              this.balance += parseFloat(this.withdrawAmount);
            } else {
              alert('You lost! Withdrawal canceled.');
              this.withdrawAmount = 0.1;
            }
          }
          this.closeModal();
        },
        
        addMessage(user, msg) {
          this.chatMessages = `
            <div style="padding: 8px 0; border-bottom: 1px solid #333;">
              <span style="color: var(--secondary); font-weight: bold;">${user}:</span> ${msg}
            </div>
            ${this.chatMessages}
          `;
        }
      }));
    });
  </script>
</body>
</html>
