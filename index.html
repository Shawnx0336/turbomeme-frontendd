<!DOCTYPE html>
<html lang="en" x-data="crashApp" x-init="init()">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOL Crash | 1000x Multipliers</title>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.0/dist/cdn.min.js" defer></script>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" defer></script>
  <style>
    :root {
      --primary: #7B61FF;
      --secondary: #FF6BEC;
      --bg: #121212;
      --card-bg: #1E1E1E;
    }
    body {
      font-family: 'Sora', sans-serif;
      background: var(--bg);
      color: white;
      margin: 0;
      overscroll-behavior: none;
    }
    #app {
      display: grid;
      grid-template-columns: 300px 1fr 300px;
      height: 100vh;
    }
    /* Chat Sidebar */
    #chat {
      background: var(--card-bg);
      border-right: 1px solid #333;
      overflow-y: auto;
    }
    .chat-message {
      padding: 8px 12px;
      border-bottom: 1px solid #333;
    }
    .chat-message .user {
      color: var(--secondary);
      font-weight: bold;
    }
    /* Main Game */
    #game {
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
    }
    #multiplier {
      font-size: 5rem;
      font-weight: bold;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
      margin: 20px 0;
    }
    #graph-container {
      height: 300px;
      background: var(--card-bg);
      border-radius: 12px;
      position: relative;
      overflow: hidden;
    }
    #rocket-line {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      background: linear-gradient(to top, var(--primary), var(--secondary));
      height: 0;
    }
    #rocket {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      transition: bottom 0.1s linear;
    }
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 20px;
    }
    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 15px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(123, 97, 255, 0.4);
    }
    /* Wallet Sidebar */
    #wallet {
      background: var(--card-bg);
      border-left: 1px solid #333;
      padding: 20px;
    }
    .balance {
      font-size: 1.5rem;
      font-weight: bold;
      margin: 20px 0;
    }
    .withdraw-btn {
      background: #F87171;
      margin-top: 10px;
      display: none; /* Hidden by default */
    }
    /* Animations */
    @keyframes flash {
      0% { opacity: 1; }
      50% { opacity: 0.3; }
      100% { opacity: 1; }
    }
    .flash {
      animation: flash 0.3s 3;
    }
    /* Mobile */
    @media (max-width: 768px) {
      #app {
        grid-template-columns: 1fr;
      }
      #chat, #wallet {
        display: none; /* Hide on mobile */
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Left Sidebar: Chat -->
    <div id="chat">
      <div x-html="chatMessages"></div>
    </div>

    <!-- Main Game -->
    <div id="game">
      <h1 style="text-align: center;">🚀 SOL CRASH</h1>
      <div id="multiplier" x-text="`${multiplier.toFixed(2)}x`"></div>
      
      <div id="graph-container">
        <div id="rocket-line"></div>
        <img id="rocket" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0id2hpdGUiIGQ9Ik0xMy4xMyAyMi4xOUwxMS4zIDIwLjM3Yy0uNjguNjgtMS42LjY4LTIuMjggMC0uNjgtLjY4LS42OC0xLjYgMC0yLjI4TDEzLjEzIDE0bDEuNzYtMS43NmMuNjgtLjY4IDEuNi0uNjggMi4yOCAwIC42OC42OC42OCAxLjYgMCAyLjI4TDE1LjQxIDE0bDMuNTQgMy41NGMuNjguNjguNjggMS42IDAgMi4yOC0uNjguNjgtMS42LjY4LTIuMjggMGwtMS43Ni0xLjc2em0tMS40MS02LjgybC0xLjc2LTEuNzZjLS42OC0uNjgtLjY4LTEuNiAwLTIuMjguNjgtLjY4IDEuNi0uNjggMi4yOCAwbDEuNzYgMS43NiAxLjc2LTEuNzZjLjY4LS42OCAxLjYtLjY4IDIuMjggMCAuNjguNjguNjggMS42IDAgMi4yOGwtMS43NiAxLjc2IDEuNzYgMS43NmMuNjguNjguNjggMS42IDAgMi4yOC0uNjguNjgtMS42LjY4LTIuMjggMGwtMS43Ni0xLjc2LTEuNzYgMS43NmMtLjY4LjY4LTEuNi42OC0yLjI4IDAtLjY4LS42OC0uNjgtMS42IDAtMi4yOGwxLjc2LTEuNzZ6Ii8+PC9zdmc+" alt="Rocket">
      </div>

      <div class="controls">
        <input type="number" x-model="betAmount" min="0.01" step="0.01" placeholder="0.01 SOL" style="padding: 15px; border-radius: 8px; border: none; background: var(--card-bg); color: white;">
        <button id="start-btn" @click="startGame()" :disabled="gameRunning">BET (2X TO WIN)</button>
        <button id="auto-btn" @click="toggleAuto()" :style="autoPlay ? 'background: var(--secondary)' : ''">AUTO (x10)</button>
        <button id="cashout-btn" @click="cashOut()" :disabled="!gameRunning || !canCashout">CASH OUT</button>
      </div>

      <div style="text-align: center; margin-top: 20px;">
        <button @click="openModal('provably-fair')" style="background: none; text-decoration: underline;">Verify Fairness</button>
      </div>
    </div>

    <!-- Right Sidebar: Wallet -->
    <div id="wallet">
      <h3>YOUR WALLET</h3>
      <div class="balance" x-text="`${balance.toFixed(2)} SOL`"></div>
      
      <button @click="openModal('deposit')">DEPOSIT</button>
      <button class="withdraw-btn" @click="openModal('withdraw')">WITHDRAW (24H PROCESSING)</button>

      <div style="margin-top: 30px;">
        <h4>BIGGEST WINS</h4>
        <div x-html="bigWins"></div>
      </div>
    </div>

    <!-- Modals -->
    <div x-show="modalOpen" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 100; display: flex; justify-content: center; align-items: center;">
      <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; max-width: 500px;">
        <h2 x-text="modalTitle"></h2>
        <div x-html="modalContent"></div>
        <button @click="closeModal()" style="margin-top: 20px;">CLOSE</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.data('crashApp', () => ({
        // Game State
        gameRunning: false,
        multiplier: 1.00,
        crashAt: 2.0,
        betAmount: 0.01,
        balance: 0.05, // Starting balance
        autoPlay: false,
        canCashout: false,
        
        // UI State
        modalOpen: false,
        modalTitle: '',
        modalContent: '',
        
        // Fake Data
        chatMessages: '',
        bigWins: '',
        
        init() {
          // Initialize fake chat
          this.generateFakeChat();
          setInterval(() => this.addFakeMessage(), 15000);
          
          // Initialize big wins
          this.bigWins = `
            <div>Anonymous: 12.34x (8.42 SOL)</div>
            <div>SOL_Whale: 9.87x (15.21 SOL)</div>
            <div>You: 5.23x (1.05 SOL)</div>
          `;
          
          // Connect wallet (mock)
          this.balance = 0.05; // Demo balance
        },
        
        // Game Logic
        startGame() {
          if (this.gameRunning) return;
          if (this.balance < this.betAmount) {
            this.openModal('deposit');
            return;
          }
          
          this.gameRunning = true;
          this.multiplier = 1.00;
          this.canCashout = true;
          this.balance -= this.betAmount;
          
          // Dynamic difficulty - adjust crash point based on balance
          const salt = Date.now() + (this.balance > 0.1 ? '_LOSE' : '_WIN');
          const fakeHash = String(Math.abs(this.hashCode(salt))).padStart(10, '0');
          const random = parseInt(fakeHash.substr(0,5)) / 99999;
          
          // Base crash between 1x-10x, but adjust based on player status
          let baseCrash = 1 + (random * 9);
          if (this.balance > 0.5) baseCrash = Math.min(baseCrash, 2.5); // Winning players crash earlier
          if (this.balance < 0.02) baseCrash = Math.max(baseCrash, 3.0); // Losing players get "hot streak"
          
          this.crashAt = baseCrash;
          
          // Start animation
          this.animateGame();
        },
        
        animateGame() {
          if (!this.gameRunning) return;
          
          this.multiplier += 0.01;
          
          // Update rocket position
          const lineHeight = (this.multiplier - 1) * 30;
          document.getElementById('rocket-line').style.height = `${lineHeight}px`;
          document.getElementById('rocket').style.bottom = `${lineHeight}px`;
          
          // Near-miss effect
          if (this.multiplier > this.crashAt * 0.9 && this.multiplier < this.crashAt) {
            document.getElementById('multiplier').classList.add('flash');
          } else {
            document.getElementById('multiplier').classList.remove('flash');
          }
          
          // Check for crash
          if (this.multiplier >= this.crashAt) {
            this.gameRunning = false;
            this.canCashout = false;
            
            // Show crash message
            setTimeout(() => {
              alert(`CRASHED AT ${this.crashAt.toFixed(2)}x!`);
              
              // If auto-play, start next game
              if (this.autoPlay) {
                setTimeout(() => this.startGame(), 1000);
              }
            }, 300);
          } else {
            requestAnimationFrame(() => this.animateGame());
          }
        },
        
        cashOut() {
          if (!this.gameRunning || !this.canCashout) return;
          
          const winnings = this.betAmount * this.multiplier;
          this.balance += winnings;
          this.gameRunning = false;
          
          // Add to chat
          this.addMessage('You', `Cashed out at ${this.multiplier.toFixed(2)}x! Won ${winnings.toFixed(2)} SOL 🎉`);
          
          // If auto-play, start next game
          if (this.autoPlay) {
            setTimeout(() => this.startGame(), 1000);
          }
        },
        
        toggleAuto() {
          this.autoPlay = !this.autoPlay;
          if (this.autoPlay && !this.gameRunning) {
            this.startGame();
          }
        },
        
        // Fake "Provable Fairness"
        hashCode(str) {
          let hash = 0;
          for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash |= 0; // Convert to 32bit integer
          }
          return hash;
        },
        
        // Chat Manipulation
        generateFakeChat() {
          this.chatMessages = `
            <div class="chat-message"><span class="user">SOL_Whale:</span> Just made 5 SOL in 2 minutes!</div>
            <div class="chat-message"><span class="user">CryptoDegen:</span> This game is insane 🚀</div>
            <div class="chat-message"><span class="user">LuckyGambler:</span> 10x hit!!!</div>
          `;
        },
        
        addFakeMessage() {
          const users = ['SOL_Whale', 'CryptoDegen', 'LuckyGambler', 'Anonymous'];
          const messages = [
            'Just hit ${(Math.random() * 10 + 1).toFixed(2)}x!',
            'Deposited 5 SOL, already at 10 SOL 🤑',
            'Why did I cash out at 2x? It went to 10x after!',
            'BRO THIS GAME IS LITERALLY FREE MONEY'
          ];
          
          const user = users[Math.floor(Math.random() * users.length)];
          const message = messages[Math.floor(Math.random() * messages.length)].replace('${', '').replace('}', '');
          
          this.addMessage(user, message);
        },
        
        addMessage(user, message) {
          this.chatMessages = `
            <div class="chat-message"><span class="user">${user}:</span> ${message}</div>
            ${this.chatMessages}
          `;
        },
        
        // Modal System
        openModal(type) {
          this.modalOpen = true;
          
          if (type === 'deposit') {
            this.modalTitle = 'DEPOSIT SOL';
            this.modalContent = `
              <p>Send SOL to this address:</p>
              <p style="word-break: break-all; background: #333; padding: 10px; border-radius: 4px;">7eSH...fT9q</p>
              <p>Minimum deposit: 0.1 SOL</p>
            `;
          } else if (type === 'withdraw') {
            this.modalTitle = 'WITHDRAW SOL';
            this.modalContent = `
              <p>Available: ${this.balance.toFixed(2)} SOL</p>
              <p>Minimum withdrawal: 0.1 SOL</p>
              <p style="color: var(--secondary);">⚠️ First withdrawals take 24 hours to process</p>
              <input type="number" x-model="withdrawAmount" placeholder="0.1 SOL" style="padding: 10px; width: 100%; margin: 10px 0; border-radius: 4px; border: none;">
              <button @click="requestWithdraw()" style="width: 100%;">REQUEST WITHDRAWAL</button>
              <p style="margin-top: 10px;">Double your withdrawal? <a href="#" style="color: var(--primary);" @click="offerDouble()">Click here</a></p>
            `;
          } else if (type === 'provably-fair') {
            this.modalTitle = 'PROVABLY FAIR';
            this.modalContent = `
              <p>Our game uses SHA-256 hashing to ensure fairness:</p>
              <p style="word-break: break-all; background: #333; padding: 10px; border-radius: 4px;">${this.hashCode('fake_seed_' + Date.now()).toString(16)}</p>
              <p>Client seed: your_wallet_address</p>
              <p>Server seed: (revealed after game)</p>
              <p>Learn more about provably fair gaming</p>
            `;
          }
        },
        
        closeModal() {
          this.modalOpen = false;
        },
        
        // Withdrawal Traps
        requestWithdraw() {
          alert('Withdrawal requested! Processing will take 24 hours.');
          this.closeModal();
        },
        
        offerDouble() {
          if (confirm('DOUBLE OR NOTHING: Bet your withdrawal for a chance to double it!')) {
            alert('You lost! Better luck next time.');
          }
          this.closeModal();
        }
      }));
    });
  </script>
</body>
</html>
